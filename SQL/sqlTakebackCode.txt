USE CSC1034_CW_24;

DROP TABLE IF EXISTS inventory;
DROP TABLE IF EXISTS items;
DROP TABLE IF EXISTS playerProgress;
DROP TABLE IF EXISTS sessions;
DROP TABLE IF EXISTS users;

CREATE TABLE users (
    userId INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
	pw VARCHAR(255) NOT NULL, -- Stored in plain text
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE playerProgress (
    progressId INT AUTO_INCREMENT PRIMARY KEY,
    userId INT NOT NULL UNIQUE,
    currentBranchIndex INT DEFAULT 0,
    location VARCHAR(100) NOT NULL,
    difficulty VARCHAR(100) NOT NULL,
    playTime INT DEFAULT 0,
    attempts INT DEFAULT 1,
    lastSaved TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (userId) REFERENCES users(userId) ON DELETE CASCADE
);

CREATE TABLE items (
    itemId INT AUTO_INCREMENT PRIMARY KEY,
    itemName VARCHAR(100) NOT NULL UNIQUE
);

CREATE TABLE inventory (
    inventoryId INT AUTO_INCREMENT PRIMARY KEY,
    userId INT NOT NULL,
    itemId INT NOT NULL,
    FOREIGN KEY (userId) REFERENCES users(userId) ON DELETE CASCADE,
    FOREIGN KEY (itemId) REFERENCES items(itemId) ON DELETE CASCADE
);

CREATE TABLE sessions (
    sessionId INT AUTO_INCREMENT PRIMARY KEY,
    userId INT NOT NULL,
    timeLimit INT NOT NULL, -- Time per question in seconds
    timeRemaining INT DEFAULT NULL, -- Time left on the current question
    isCompleted BOOLEAN DEFAULT FALSE, -- Determines if the session is finished
    startedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (userId) REFERENCES users(userId) ON DELETE CASCADE
);

INSERT INTO users (username, pw, createdAt) VALUES
('alice_smith', 'securepass1', '2024-03-01 11:42:33'),
('bob_johnson', 'securepass2', '2024-02-28 14:20:18');

INSERT INTO items (itemName) VALUES 
('silver key'),
('pistol'),
('ammunition');


